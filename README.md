Script-Backup
=============

Provides a simple command line method for generating script backups of a database or mulitple databases in a single process.

### The Good

The sql server management studio is a very useful program and provides alot of useful tools. One of the most useful features is the ability to generate scripts that can create a schema and even create the data of a database using sql statements. It is often less error prone to recreate a raw database using these scripts than a database backup file as backup files can be touchy about using exactly the same server type as it was taken from.

### The Bad

Unlike backup files that can be generated by t-sql scripts, the process is only accessible by installing the management studio (which requires installing .Net 3.5 on Windows 8+) and then loading it each time you want to generate a script of a database and you also have to change the settings each time, which from experience is easy to get wrong, then generating one database at a time.

### A Small Solution

I decided to build this console application, where you could supply a list of options and let it create the scripts when run, these settings can easily be saved in a batch file to repeat the process. This has an advantage of saving a database structure to source control when you happy with it in one click.

#### Options

- -connection (or -server):

  The connection information to the server you want to script *__Required__*

  - -connection: A connection string used to connect to the server. Note: The initial database is not required in the connection string.

  - -server: Instead of a complete connection string you can just supply a server name. Note: If you supply both connection and server arguments, connection is used and this requires the server to be accessible as a trusted connection.


- -output:

  The full file path you want the output to be stored in, with optional placeholders. Simply replace the following placeholders, although each of the options are entirely optional. *__Required__*

  The following is replaced by:
    - {0} (string) The name of the server
    - {1} (string) The name of the currently executing database
    - {2} (string) The name of the currently executing object e.g. table name
    - {3} (string) The type of the currently executing object e.g. table
    - {4} (datetime) The start time of the process e.g. 2014-01-01
    - {5} (string) The current type of output i.e. whether its a 'schema' output or 'data' output

  Note the format can of the datetime can be replaced using the formating options on [MSDN](http://msdn.microsoft.com/en-us/library/8kb3ddd4%28v=vs.110%29.aspx)

- -dbs:

  A comma seperated list of databases on the server you want to output. If the database is not found on the server it will simply be ignored. *__Default:__ all databases*


- -tables:

  A comma seperated list of tables in a database you want to output. *__Default:__ all tables*


- -silent

  If present prevents output of tracing information and then closes without asking for input *__Default:__ show all output*


- -type: *__Default:__ all*

  What you actually want to output, options:

  - schema
  - data
  - all

#### Example:

To create seperate script and data files for each database in the attached list, where each file has a date stamp run the following command, as you can see you can apply formatting to the placeholders and you dont have to use all if any of the placeholders

scriptbackup.exe -type:all "-output:c:\scripts\{0}\{1}\{5} {4:yyyy-MM-dd}.sql" "-dbs:Database_A, Database_B" -silent

#### Issues

- On Sql Server 2000 the server itself does not always give a reliable report as to dependencies in views so can output the views in a slightly incorrect order. The script is complete, but might require some slight re-ordering.

- I am aware that the system doesnt currently work with azure databases, although should not be too difficult to give it support

#### Warning

This software is tested, but not under every circumstance, so if you are to delete the database as well to avoid any data loss I recommended a backup. I am not responsible for any data loss using this program.
